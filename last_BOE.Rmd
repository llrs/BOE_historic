---
title: "Lo último del BOE"
description: "Resumen de lo publicado hoy en el BOE."
base_url: https:llrs.github.io/BOE_historico/
preview: boe-01.png
repository_url: https://github.com/llrs/BOE_historico
output_dir: docs
template:
  opengraph:
    image:
      src: boe-01.png
      alt: "Resumen en formato tabla del último sumario del BOE."
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r dates, include=FALSE}
today <- Sys.Date()
yesterday <- today -1
library("BOE")
sumario_hoy <- try(retrieve_sumario(today), silent = TRUE)
d <- today
if (is(sumario_hoy, "try-error")) {
    d <- yesterday
   sumario_hoy <- retrieve_sumario(yesterday)
}
ts <- table(gsub(pattern = "BOE-([AB])-.*", replacement = "\\1", sumario_hoy$publication))
```

# Resumen grafico

Esta página web contine el último sumario del BOE publicado el `r d` con `r nrow(sumario_hoy)` publicaciones, de las cuales `r ts[["A"]]` son disposiciones.

```{r graphics, layout="l-body-outset", echo=FALSE, message=FALSE, warning=FALSE, error=FALSE, fig.width=40, fig.asp=1}
library("dplyr")
library("ggalluvial")
library("forcats")
library("patchwork")
freqs <- sumario_hoy %>% 
    mutate(Type = ifelse(is.na(epigraph), "Anuncio", "Disposición")) %>% 
    group_by(section, departament, Type, epigraph) %>% 
    count(name = "Freq", sort = TRUE) %>% 
    ungroup() %>% 
    arrange(section, departament) %>% 
    mutate(section = fct_inorder(as.factor(section)),
           departament = fct_inorder(as.factor(tolower(departament))),
           epigraph = fct_inorder(as.factor(epigraph)))
p1 <- freqs %>% 
    filter(Type == "Anuncio") %>% 
    ggplot(aes(y = Freq, axis1 = section, axis2 = departament)) +
    geom_alluvium() +
    geom_stratum(fill = "white", color = "darkgrey") +
    geom_text(stat = "stratum", aes(label = after_stat(stratum))) +
    guides(fill = FALSE) +
    theme_void() +
    labs(title = "Anuncios", caption = "Fuente: Agencia Estatal del Boletín Oficial del Estado")
p2 <- freqs %>% 
    filter(Type != "Anuncio") %>% 
    ggplot(aes(y = Freq, axis1 = section, axis2 = departament, axis3 = epigraph)) +
    geom_alluvium() +
    geom_stratum(fill = "white", color = "darkgrey") +
    geom_text(stat = "stratum", aes(label = after_stat(stratum))) +
    guides(fill = FALSE) +
    theme_void() +
    labs(title = "Disposiciones")
p2 + p1
```

# Tabla

Aquí está la tabla completa con links:

```{r report, echo=FALSE, layout="l-body-outset"}
pubs <- url_publications(sumario_hoy)
pubs <- paste0("<a href=", pubs, ">", sumario_hoy$publication, "</a>")
s <- cbind(sumario_hoy, pubs)
s <- s[, -c(1, 2, 3, 4, 7, 10)]
colnames(s) <- c("Sección", "Departamento", "Epígrafe", "Texto", "Páginas", "Link")
DT::datatable(s, filter = 'top', options = list(
  pageLength = 10, autoWidth = TRUE
), escape = FALSE)
```


```{r twitter, include=FALSE}
library("rtweet")
nacionalizaciones <- sum(grepl(x = sumario_hoy$text, 
            pattern = "concede la nacionalidad española"))
extravios <- sum(grepl(x = sumario_hoy$text, 
                               pattern = "extrav[íi]o del? (un )?t[íi]tulo"))
disposiciones <- ts[["A"]]
anuncios <- ts[["B"]]
link <- "Lo podeis consultar fácilmente en https://llrs.github.io/BOE_historico/last_BOE.html"
status <- paste("En el último BOE hay", disposiciones, "disoposiciones y",
                anuncios, "anuncios.\n")
if (extravios > 0) {
  status <- paste0(status, "Hoy hay ", extravios, 
         " extravíos de títulos universitarios.\n")
}
if (nacionalizaciones > 0) {
  status <- paste0(status, "Hoy hay ", nacionalizaciones, 
         " cartas de naturaleza.\n")
}
```

