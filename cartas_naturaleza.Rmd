---
title: "Cartas de naturaleza"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(cache = TRUE, echo = FALSE)
```


```{r setup_BOE}
suppressPackageStartupMessages(library("data.table", warn.conflicts = FALSE))
library("dtplyr", warn.conflicts = FALSE)
library("dplyr", warn.conflicts = FALSE)
library("lubridate", warn.conflicts = FALSE)
suppressPackageStartupMessages(library("ggplot2", warn.conflicts = FALSE))
library("gghighlight", warn.conflicts = FALSE)
library("forcats", warn.conflicts = FALSE)
library("stringr", warn.conflicts = FALSE)

dff <- fread("../BOE_sumario/till_20191117.csv", sep = "\t", quote = FALSE)
dff <- dff %>% 
    lazy_dt() %>% 
    mutate(date = as.Date(date, format = "%d/%m/%Y"),
           weekday = weekdays(date))
```


```{r buscando}
cn <- dff %>% 
    mutate(CN = str_detect(text, "carta de naturaleza"))
cn <- cn %>% 
    filter(CN) %>% 
    as_tibble()
```

Esta vez repito un poco el análisis de [Cívio](https://civio.es/el-boe-nuestro-de-cada-dia/2013/06/24/espanoles-por-decreto/), pero sólo a partir de 2009 y hasta 2019. Más que nada para confirmar que las cifras cuadren, que efectivamente se da.

```{r dates}
cn %>% 
    count(date) %>% 
    ggplot(aes(date, n)) + 
    geom_col() +
    scale_x_date(labels = scales::date_format("%Y"), date_breaks = "1 year") +
    scale_y_continuous(expand = c(0, 1)) +
    labs(x = element_blank(), y = "Cartas de naturaleza",
         caption = "Fuente: Agencia Estatal del Boletín Oficial del Estado") +
    theme_bw()
```

```{r years}
cn %>% 
    count(Year = format(date, "%Y")) %>%
    mutate(Cartas = "Yes") %>% 
    ggplot() + 
    geom_col(aes(Year, n)) +
    scale_y_continuous(expand = c(0, 10)) +
    labs(x = element_blank(), y = "Cartas de naturaleza",
         caption = "Fuente: Agencia Estatal del Boletín Oficial del Estado") +
    theme_bw() +
    theme(panel.grid.major.x = element_blank())
    
cn %>% 
    count(Year = format(date, "%Y")) %>%
    knitr::kable(row.names = FALSE, align = "c")
```

